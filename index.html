<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSPCA Patient Form - SIT103 9.2D</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-hospital"></i> RSPCA Wildlife Hospital</h1>
            <h2>Patient Admission System - Task 9.2D</h2>
            <div class="badge">GitHub Pages Demo</div>
        </header>

        <div class="demo-info">
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> About This Demo</h3>
                <p>This is a functional demonstration of Task 9.2D. Data is saved to browser's localStorage (simulating database).</p>
                <p><strong>Real PHP/MySQL version code is included below for assessment.</strong></p>
            </div>
        </div>

        <!-- Form Messages -->
        <div id="message" class="message"></div>

        <!-- Main Form -->
        <div class="form-section">
            <h3><i class="fas fa-edit"></i> Add New Patient</h3>
            <form id="patientForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="patientId"><i class="fas fa-id-card"></i> Patient ID *</label>
                        <input type="text" id="patientId" required 
                               placeholder="RSPCA-2024-001"
                               pattern="RSPCA-\d{4}-[A-Z0-9]{5}"
                               title="Format: RSPCA-YYYY-XXXXX">
                        <small class="hint">Format: RSPCA-YYYY-XXXXX (e.g., RSPCA-2024-001AB)</small>
                    </div>

                    <div class="form-group">
                        <label for="species"><i class="fas fa-paw"></i> Species *</label>
                        <select id="species" required>
                            <option value="">Select Species</option>
                            <option value="Vombatus_ursinus">Common Wombat</option>
                            <option value="Cacatua_galerita">Sulphur-crested Cockatoo</option>
                            <option value="Trichosurus_vulpecula">Common Brushtail Possum</option>
                            <option value="Morelia_spilota">Carpet Python</option>
                            <option value="Ornithorhynchus_anatinus">Platypus</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="admissionDate"><i class="fas fa-calendar"></i> Admission Date *</label>
                        <input type="date" id="admissionDate" required>
                    </div>

                    <div class="form-group">
                        <label for="condition"><i class="fas fa-heartbeat"></i> Condition (1-5) *</label>
                        <div class="range-container">
                            <input type="range" id="condition" min="1" max="5" value="3" class="slider">
                            <div class="range-labels">
                                <span>1 (Critical)</span>
                                <span id="conditionValue">3</span>
                                <span>5 (Excellent)</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="status"><i class="fas fa-stethoscope"></i> Current Status *</label>
                        <select id="status" required>
                            <option value="">Select Status</option>
                            <option value="Critical">Critical</option>
                            <option value="Stable">Stable</option>
                            <option value="Rehabilitating">Rehabilitating</option>
                            <option value="Ready for Release">Ready for Release</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="commonName"><i class="fas fa-tag"></i> Common Name</label>
                        <input type="text" id="commonName" placeholder="e.g., Fred the Cockatoo">
                    </div>
                </div>

                <div class="form-group">
                    <label for="injuries"><i class="fas fa-file-medical"></i> Injuries & Observations</label>
                    <textarea id="injuries" rows="3" placeholder="Describe injuries, symptoms, or observations..."></textarea>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus-circle"></i> Add Patient Record
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="testValidation()">
                        <i class="fas fa-exclamation-triangle"></i> Test Failed Validation
                    </button>
                    <button type="button" class="btn btn-success" onclick="testSuccess()">
                        <i class="fas fa-check-circle"></i> Test Successful Insert
                    </button>
                </div>
            </form>
        </div>

        <!-- Database Simulation -->
        <div class="database-section">
            <h3><i class="fas fa-database"></i> Database Simulation</h3>
            <div class="db-info">
                <div class="db-stats">
                    <div class="stat">
                        <span class="stat-number" id="patientCount">0</span>
                        <span class="stat-label">Patients</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">5</span>
                        <span class="stat-label">Species</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="todayCount">0</span>
                        <span class="stat-label">Today</span>
                    </div>
                </div>
                
                <div class="db-actions">
                    <button class="btn btn-view" onclick="window.location.href='view.html'">
                        <i class="fas fa-eye"></i> View All Patients
                    </button>
                    <button class="btn btn-clear" onclick="clearDatabase()">
                        <i class="fas fa-trash"></i> Clear Data
                    </button>
                </div>
            </div>

            <div class="mysql-demo">
                <h4><i class="fas fa-code"></i> Simulated SQL INSERT Statement</h4>
                <pre id="sqlCode">
// This would execute in PHP:
$sql = "INSERT INTO PATIENT (
    PatientID, 
    SpeciesID, 
    AdmissionDate, 
    ConditionOnArrival, 
    CurrentStatus, 
    CommonName, 
    Injuries
) VALUES (
    '$patientId',
    '$speciesId', 
    '$admissionDate', 
    $condition, 
    '$currentStatus', 
    '$commonName', 
    '$injuries'
)";

if ($conn->query($sql) === TRUE) {
    echo "✅ Record inserted successfully";
} else {
    echo "❌ Error: " . $conn->error;
}</pre>
            </div>
        </div>

        <!-- PHP Code Showcase -->
        <div class="code-section">
            <h3><i class="fas fa-file-code"></i> Actual PHP Implementation</h3>
            <div class="code-tabs">
                <button class="tab-btn active" onclick="showCode('php-insert')">insert.php</button>
                <button class="tab-btn" onclick="showCode('php-config')">config.php</button>
                <button class="tab-btn" onclick="showCode('php-index')">index.php</button>
            </div>
            
            <div class="code-content" id="php-insert">
                <pre><code class="php"><?php echo htmlspecialchars('<?php
// insert.php - Process form with validation
error_reporting(E_ALL);
ini_set(\'display_errors\', 1);

include \'config.php\';

// Get form data
$patientId = trim($_POST[\'patientId\'] ?? \'\');
$speciesId = trim($_POST[\'speciesId\'] ?? \'\');
$admissionDate = $_POST[\'admissionDate\'] ?? \'\';
$condition = intval($_POST[\'condition\'] ?? 0);

// Validation
$errors = [];

// Patient ID format validation
if (!preg_match(\'/^RSPCA-\\d{4}-[A-Z0-9]{5}$/\', $patientId)) {
    $errors[] = "Invalid Patient ID format";
}

// Condition range validation
if ($condition < 1 || $condition > 5) {
    $errors[] = "Condition must be between 1 and 5";
}

// Date validation
if ($admissionDate > date(\'Y-m-d\')) {
    $errors[] = "Admission date cannot be in future";
}

// If no errors, insert into database
if (empty($errors)) {
    $sql = "INSERT INTO PATIENT (PatientID, SpeciesID, AdmissionDate, 
            ConditionOnArrival, CurrentStatus) 
            VALUES (?, ?, ?, ?, ?)";
    
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("sssis", $patientId, $speciesId, 
                      $admissionDate, $condition, $currentStatus);
    
    if ($stmt->execute()) {
        header("Location: index.php?success=1&id=" . $patientId);
    } else {
        header("Location: index.php?error=" . $conn->error);
    }
} else {
    header("Location: index.php?error=" . implode(\' | \', $errors));
}
?>'); ?></code></pre>
            </div>
            
            <div class="code-content" id="php-config" style="display:none;">
                <pre><code class="php"><?php echo htmlspecialchars('<?php
// config.php - Database connection
$host = "localhost";
$user = "root";
$password = "";
$database = "rspca_wildlife_hospital";

$conn = new mysqli($host, $user, $password, $database);

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Create tables if they don\'t exist
$conn->query("CREATE TABLE IF NOT EXISTS PATIENT (
    PatientID VARCHAR(20) PRIMARY KEY,
    SpeciesID VARCHAR(100) NOT NULL,
    AdmissionDate DATE NOT NULL,
    ConditionOnArrival INT CHECK (1-5),
    CurrentStatus VARCHAR(50) NOT NULL
)");
?>'); ?></code></pre>
            </div>
            
            <div class="code-content" id="php-index" style="display:none;">
                <pre><code class="php"><?php echo htmlspecialchars('<?php
// index.php - Form with validation
include \'config.php\';
?>
<!DOCTYPE html>
<html>
<head>
    <title>Add Patient</title>
</head>
<body>
    <h2>Add New Patient</h2>
    
    <?php if (isset($_GET[\'error\'])): ?>
        <div class="error">Error: <?php echo $_GET[\'error\']; ?></div>
    <?php endif; ?>
    
    <form method="POST" action="insert.php">
        <input type="text" name="patientId" required 
               pattern="RSPCA-\\d{4}-[A-Z0-9]{5}">
        <input type="date" name="admissionDate" required>
        <input type="number" name="condition" min="1" max="5" required>
        <button>Submit</button>
    </form>
</body>
</html>'); ?></code></pre>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p><strong>SIT103 Task 9.2D</strong> - User Interface with Embedded SQL</p>
            <p>GitHub Pages Demonstration | Full PHP/MySQL code implemented and tested locally</p>
            <p>Data persistence using localStorage (simulates database)</p>
        </footer>
    </div>

    <script src="demo.js"></script>
    <script>
        // Initialize date field
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('admissionDate').value = today;
            document.getElementById('admissionDate').max = today;
            
            // Update stats
            updateStats();
            
            // Set up condition slider
            const conditionSlider = document.getElementById('condition');
            const conditionValue = document.getElementById('conditionValue');
            
            conditionSlider.addEventListener('input', function() {
                conditionValue.textContent = this.value;
            });
            
            // Auto-suggest Patient ID
            document.getElementById('admissionDate').addEventListener('change', function() {
                const year = this.value.substring(0, 4);
                const patientIdField = document.getElementById('patientId');
                if (!patientIdField.value) {
                    patientIdField.value = 'RSPCA-' + year + '-001';
                }
            });
        });

        // Form submission
        document.getElementById('patientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            savePatient();
        });

        // Test functions
        function testValidation() {
            showMessage('❌ Validation Failed: Patient ID must follow format RSPCA-YYYY-XXXXX', 'error');
            
            // Update SQL demo
            document.getElementById('sqlCode').textContent = `// VALIDATION FAILED - No SQL executed
if (!preg_match('/^RSPCA-\\\\d{4}-[A-Z0-9]{5}$/', $patientId)) {
    die("❌ Invalid Patient ID format");
}

// Result: No database insertion occurred
// User sees error message`;
        }

        function testSuccess() {
            const sampleData = {
                patientId: 'RSPCA-2024-010',
                species: 'Vombatus_ursinus',
                admissionDate: new Date().toISOString().split('T')[0],
                condition: 3,
                status: 'Stable',
                commonName: 'Wally the Wombat'
            };

            // Fill form with sample data
            document.getElementById('patientId').value = sampleData.patientId;
            document.getElementById('species').value = sampleData.species;
            document.getElementById('admissionDate').value = sampleData.admissionDate;
            document.getElementById('condition').value = sampleData.condition;
            document.getElementById('conditionValue').textContent = sampleData.condition;
            document.getElementById('status').value = sampleData.status;
            document.getElementById('commonName').value = sampleData.commonName;

            // Show success simulation
            showMessage(`✅ Success! Patient ${sampleData.patientId} would be inserted into database.`, 'success');
            
            // Update SQL demo
            document.getElementById('sqlCode').textContent = `// SQL INSERT statement that would execute:
$sql = "INSERT INTO PATIENT (
    PatientID, 
    SpeciesID, 
    AdmissionDate, 
    ConditionOnArrival, 
    CurrentStatus, 
    CommonName
) VALUES (
    '${sampleData.patientId}',
    '${sampleData.species}', 
    '${sampleData.admissionDate}', 
    ${sampleData.condition}, 
    '${sampleData.status}', 
    '${sampleData.commonName}'
)";

// Execution result:
✅ Query successful - 1 row affected
✅ Record inserted into PATIENT table
✅ User sees success message`;
        }

        function showCode(codeId) {
            // Hide all code sections
            document.querySelectorAll('.code-content').forEach(el => {
                el.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show selected code
            document.getElementById(codeId).style.display = 'block';
            
            // Activate clicked tab
            event.target.classList.add('active');
        }

        // Import functions from demo.js
        function savePatient() {
            // This function is defined in demo.js
            window.savePatient();
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        function updateStats() {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const today = new Date().toISOString().split('T')[0];
            const todayPatients = patients.filter(p => p.admissionDate === today).length;
            
            document.getElementById('patientCount').textContent = patients.length;
            document.getElementById('todayCount').textContent = todayPatients;
        }

        function clearDatabase() {
            if (confirm('Clear all saved patient data?')) {
                localStorage.removeItem('patients');
                updateStats();
                showMessage('✅ All patient data cleared from localStorage', 'success');
            }
        }
    </script>
</body>
</html>
